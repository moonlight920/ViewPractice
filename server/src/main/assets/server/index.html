<!DOCTYPE html>
<html lang="en">

<head>
    <title>Debug Server</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='shortcut icon' href='static/favicon.ico' type='image/x-icon'>

    <script src="static/script/jquery.min.js"></script>
    <script src="static/script/bootstrap.min.js"></script>
    <script src="static/script/vue.js"></script>
    <script src="static/script/httpVueLoader.js"></script>
    <link href="static/style/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div id="my-app">
        <my-header v-if="htmlTitle" v-bind:title="htmlTitle"></my-header>
        <div class="container padding-fifty">
            <div class="row padding-twenty">
                <!--å·¦ä¾§å¯¼èˆªæ -->
                <div class="col-sm-2">
                    <ul id="hdt-nav" class="nav nav-pills nav-stacked">
                        <li v-for="(v,k) in plugins" :key="k" @click="currentTab=k" :class="{active:currentTab===k}">
                            <a>{{v.name}}</a>
                        </li>
                    </ul>
                </div>
                <!--æ“ä½œåŒº-->
                <div id="hdt-content" class="col-sm-10">
                    <div v-if="currentTab>=0" class="padding-twenty" style="margin-bottom: 16px">
                        <div v-for="(plugin,index) in plugins">
                            <div v-show="index === currentTab">
                                <push-plugin v-if="plugin.type===1" v-bind:config="plugin"></push-plugin>
                                <pull-plugin v-else-if="plugin.type===2" v-bind:config="plugin"></pull-plugin>
                                <!-- åŠ¨æ€ç»„ä»¶ï¼Œåœ¨èŽ·å–é…ç½®åŽç”Ÿæˆ -->
                                <component v-else-if="plugin.type===3" v-bind:is="plugin.config.componentName">
                                </component>
                                <custom-plugin v-else v-bind:config="plugin"></custom-plugin>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="snackbar"></div>
        </div>
    </div>
    <script type="text/javascript">
        new Vue({
            el: '#my-app',
            data: {
                currentTab: -1,
                tabView: '',
                plugins: [],
                htmlTitle: ''
            },
            components: {
                'my-header': httpVueLoader('components/MyHeader.vue'),
                'push-plugin': httpVueLoader('components/PushPlugin.vue'),
                'pull-plugin': httpVueLoader('components/PullPlugin.vue'),
                'custom-plugin': httpVueLoader('components/CustomPlugin.vue')
            },
            mounted() {
                let root = this;

                // const fake = '{"title":"hxz debug tools","plugins":[{"pid":"ShowCommonConfigPlugin","name":"æ‰‹æœºå±žæ€§","type":2,"config":{"desc":"èŽ·å–ä¸€äº›é…ç½®ä¿¡æ¯","pullList":[{"key":"net-common","name":"è¯·æ±‚å…¬å‚"},{"key":"apollo","name":"Apolloé…ç½®"}]}},{"pid":"ApolloPlugin","name":"ApolloæŸ¥è¯¢","type":1,"config":{"desc":"","inputList":[{"demos":[],"desc":"è¾“å…¥toggle","key":"toggle"}]}},{"pid":"PushMockPlugin","name":"æ¨¡æ‹Ÿpush","type":1,"config":{"desc":"å¯ä»¥ç”¨æ¥ç›´æŽ¥å‘é€pushç›´è¾¾app","inputList":[{"demos":[{"data":"/json/pay_in_car.json","name":"è½¦å†…ä»˜","type":1},{"data":"/json/modify_dest.json","name":"ä¿®æ”¹ç›®çš„åœ°","type":1},{"data":"{}","name":"ç©ºæ•°æ®","type":2}],"desc":"è¯·è¾“å…¥ä¸€æ®µjson","key":"key_push"}]}},{"pid":"H5MockPlugin","name":"H5ä»»æ„é—¨","type":1,"config":{"desc":"å‘é€urlï¼Œç«¯ä¸Šæ‰“å¼€","inputList":[{"demos":[{"data":"https://kfpub.hongyibo.com.cn/static/kfpub/6b19c04bce06c1c3241d46b9f493876b/index.html","name":"ä¸€è·¯è¿Žæ˜¥å‘","type":2},{"data":"https://kfpub.hongyibo.com.cn/static/kfpub/7cc6d2f0d31d1e7c5cac191ddabc460f/index.html","name":"é˜²ç–«","type":2},{"data":"kfhxztravel://router/setting","name":"Nativeè®¾ç½®é¡µé¢","type":2}],"desc":"è¯·è¾“å…¥ä¸€ä¸ªHttpUrl","key":"key_h5_2"},{"demos":[{"data":"https://kfpub.hongyibo.com.cn/static/kfpub/6b19c04bce06c1c3241d46b9f493876b/index.html","name":"ä¸€è·¯è¿Žæ˜¥å‘","type":2},{"data":"https://kfpub.hongyibo.com.cn/static/kfpub/7cc6d2f0d31d1e7c5cac191ddabc460f/index.html","name":"é˜²ç–«","type":2},{"data":"kfhxztravel://router/setting","name":"Nativeè®¾ç½®é¡µé¢","type":2}],"desc":"è¯·è¾“å…¥ä¸€ä¸ªHttpUrl","key":"key_h5_1"}]}},{"pid":"LottieMockPlugin","name":"lottieé¢„è§ˆ","type":1,"config":{"desc":"å¡«å…¥lottieçš„jsonæ•°æ®ï¼Œåœ¨ç«¯ä¸Šé¢„è§ˆåŠ¨ç”»","inputList":[{"demos":[{"data":"/json/suihua.json","name":"ç¢ŽèŠ±åŠ¨ç”»","type":1},{"data":"/json/lottie-rocket.json","name":"å°ç«ç®­ðŸš€","type":1},{"data":"/json/lottie-lurking-cat.json","name":"å°çŒ«","type":1}],"desc":"è¯·è¾“å…¥ä¸€ä¸ªlottieçš„jsonæ•°æ®","key":"key_lottie"}]}},{"pid":"ShowUserPlugin","name":"æ˜¾ç¤ºå½“å‰ç”¨æˆ·","type":2,"config":{"desc":"èŽ·å–å½“å‰ç”¨æˆ·ä¿¡æ¯","pullList":[{"key":"token","name":"ç”¨æˆ·token"},{"key":"uid","name":"ç”¨æˆ·uid"},{"key":"phonenumber","name":"ç”¨æˆ·æ‰‹æœºå·"},{"key":"user","name":"ç”¨æˆ·ä¿¡æ¯"}]}},{"pid":"ShowOrderDetailPlugin","name":"æ˜¾ç¤ºå½“å‰è®¢å•","type":2,"config":{"desc":"èŽ·å–å½“å‰è®¢å•ä¿¡æ¯","pullList":[{"key":"order","name":"è®¢å•"},{"key":"oid","name":"è®¢å•å·"}]}}]}'
                // root.plugins = JSON.parse(fake).plugins

                $.ajax({
                    url: "api/config", success: function (result) {
                        result = JSON.parse(result);
                        if (result != null) {
                            document.title = result.title
                            root.htmlTitle = result.title
                            if (result.plugins.length > 0) {
                                for (let index = 0; index < result.plugins.length; index++) {
                                    let plugin = result.plugins[index]
                                    // typeæ˜¯3ï¼Œæ­¤æ’ä»¶ä¸ºè‡ªå®šä¹‰çš„vueç»„ä»¶ï¼Œå…ˆåŠ¨æ€æ³¨å†Œè¿›æ¥
                                    if (plugin.type === 3) {
                                        registerComponent(plugin.config.componentName, httpVueLoader.load(plugin.config.componentPath))
                                    }
                                }
                                root.plugins = result.plugins
                                root.currentTab = 0
                            }
                        } else {
                            showErrorInfo('èŽ·å–configå¤±è´¥')
                        }
                    }
                });
            }
        });
        /**
         * åŠ¨æ€æ³¨å†Œç»„ä»¶ï¼Œç„¶åŽä½¿ç”¨
         * name ç»„ä»¶åç§°
         * path ç»„ä»¶ç›¸å¯¹è·¯å¾„
         */
        function registerComponent(name, path) {
            Vue.component(name, path);
        }

        function showSuccessInfo(message) {
            var snackbarId = "snackbar";
            var snackbarElement = $("#" + snackbarId);
            snackbarElement.addClass("show");
            snackbarElement.css({ "backgroundColor": "#5cb85c" });
            snackbarElement.html(message)
            setTimeout(function () {
                snackbarElement.removeClass("show");
            }, 3000);
        }

        function showErrorInfo(message) {
            var snackbarId = "snackbar";
            var snackbarElement = $("#" + snackbarId);
            snackbarElement.addClass("show");
            snackbarElement.css({ "backgroundColor": "#d9534f" });
            snackbarElement.html(message)
            setTimeout(function () {
                snackbarElement.removeClass("show");
            }, 3000);
        }
    </script>
    <style>
        .padding-fifty {
            padding-top: 50px;
        }

        .padding-twenty {
            padding-top: 20px;
        }

        #snackbar {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #5cb85c;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            font-size: 17px;
        }

        #snackbar.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        .display-none {
            display: none;
        }

        .list-group-item {
            word-break: break-all;
        }

        .list-group-item.selected {
            background: #dff0d8 !important;
            color: #3c763d !important;
            font-weight: bold;
        }

        @-webkit-keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
</body>

</html>